app.controller("Portal",["$scope","$http","$filter","$uibModal","Upload",function(a,b,c,d,e){a.init=function(){b.get("/api/product").success(function(c){for(var d in c)for(var e in c[d])if("Category"===e&&(c[d].CategoryName=c[d][e].CategoryName,delete c[d].Category),"ProductStatus"===e)switch(c[d].ProductStatus){case 1:c[d].ProductStatus="Draft";break;case 2:c[d].ProductStatus="Live"}a.products=c,a.safeproducts=c,b.get("/api/category").success(function(c){a.categories=c,a.safecategories=c,b.get("/api/order").success(function(b){for(var c in b)for(var d in b[c])if("OrderPaid"===d)switch(b[c].OrderPaid){case!1:b[c].OrderStatus="Refunded";break;case!0:b[c].OrderStatus="Paid"}a.orders=b,a.safeorders=b}).error(function(a){console.log(a)})}).error(function(a){console.log(a)})}).error(function(a){console.log(a)})},a.init(),a.openProduct=function(c,f,g){a.productid=g,a.title=f;d.open({animation:!0,templateUrl:"/modals/product.html",controller:["$scope","$uibModalInstance","title","productid","init",function(a,c,d,f,g){a.title=d,a.data={},a.status=[{StatusID:1,StatusName:"Draft"},{StatusID:2,StatusName:"Live"}],"Edit"===d&&b.get("/api/product/"+f).success(function(b){a.data.ProductName=b.ProductName,a.data.ProductPrice=b.ProductPrice,a.data.ProductStatus=b.ProductStatus,a.data.CategoryID=b.Category.CategoryID}).error(function(a){console.log(a)}),a.cancel=function(){c.dismiss("cancel")},a.ok=function(){switch(d){case"Add":e.upload({url:"/api/product",data:{ProductImage:a.data.ProductImage,ProductName:a.data.ProductName,ProductPrice:a.data.ProductPrice,ProductStatus:a.data.ProductStatus,CategoryID:a.data.CategoryID},method:"POST"}).then(function(b){a.data.ProductImage="",a.data.ProductName="",a.data.ProductPrice="",a.data.ProductStatus="",a.data.CategoryID="",g(),c.close()},function(a){console.log(a.status)});break;case"Edit":e.upload({url:"/api/product",data:{ProductImage:a.data.ProductImage,ProductName:a.data.ProductName,ProductPrice:a.data.ProductPrice,ProductStatus:a.data.ProductStatus,CategoryID:a.data.CategoryID,ProductID:f},method:"PUT"}).then(function(b){a.data.ProductImage="",a.data.ProductName="",a.data.ProductPrice="",a.data.ProductStatus="",a.data.CategoryID="",g(),c.close()},function(a){console.log(a.status)})}}}],size:c,resolve:{title:function(){return a.title},productid:function(){return a.productid},init:function(){return a.init}}})},a.deleteProduct=function(c,e){a.productid=e;d.open({animation:!0,templateUrl:"/modals/confirm.html",controller:["$scope","$uibModalInstance","productid","init",function(a,c,d,e){a.cancel=function(){c.dismiss("cancel")},a.ok=function(){b["delete"]("/api/product/"+d).success(function(a){e(),c.close()}).error(function(a){console.log(a)})}}],size:c,resolve:{productid:function(){return a.productid},init:function(){return a.init}}})},a.openCategory=function(c){d.open({animation:!0,templateUrl:"/modals/category.html",controller:["$scope","$uibModalInstance","init",function(a,c,d){a.data={},a.cancel=function(){c.dismiss("cancel")},a.ok=function(){b.post("/api/category",{CategoryName:a.data.CategoryName}).success(function(a){d(),c.close()}).error(function(a){console.log(a)})}}],size:c,resolve:{init:function(){return a.init}}})},a.deleteCategory=function(c,e){a.categoryid=e;d.open({animation:!0,templateUrl:"/modals/confirm.html",controller:["$scope","$uibModalInstance","categoryid","init",function(a,c,d,e){a.cancel=function(){c.dismiss("cancel")},a.ok=function(){b["delete"]("/api/category/"+d).success(function(a){e(),c.close()}).error(function(a){console.log(a)})}}],size:c,resolve:{categoryid:function(){return a.categoryid},init:function(){return a.init}}})},a.saveShipping=function(a,c){c.length<1&&(c=null),b.put("/api/order",{OrderGUID:a,OrderShipCode:c}).success(function(a){console.log("order updated")}).error(function(a){console.log(a)})},a.refundOrder=function(c,e){a.orderid=e;d.open({animation:!0,templateUrl:"/modals/confirm.html",controller:["$scope","$uibModalInstance","orderid","init",function(a,c,d,e){a.cancel=function(){c.dismiss("cancel")},a.ok=function(){b.get("/admin/order/"+d+"/refund").success(function(a){e(),c.close()}).error(function(a){console.log(a)})}}],size:c,resolve:{orderid:function(){return a.orderid},init:function(){return a.init}}})}}]);